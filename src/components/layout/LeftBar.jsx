import React, { useEffect, useState } from "react";
import { useNavigate, useLocation } from "react-router-dom";
import BarActive from "../../assets/images/BarActive.svg";
import BarUnactive from "../../assets/images/BarUnactive.svg";

const LeftBar = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const [activeBarIndex, setActiveBarIndex] = useState(0);
  const [isScrolled, setIsScrolled] = useState(0);

  const handleBack = () => {
    if (window.history.length > 1) {
      navigate(-1);
    } else {
      navigate("/");
    }
  };

  useEffect(() => {
    const handleScroll = () => {
      const sections = [
        { id: "hero", index: 0 },
        { id: "projects", index: 1 },
        { id: "about", index: 2 },
        { id: "contact", index: 3 },
      ];

      let activeIndex = 0;
      sections.forEach(({ id, index }) => {
        const element = document.getElementById(id);
        if (element) {
          const rect = element.getBoundingClientRect();
          if (
            rect.top <= window.innerHeight / 2 &&
            rect.bottom > window.innerHeight / 2
          ) {
            activeIndex = index;
          }
        }
      });
      setActiveBarIndex(activeIndex);
    };

    const handleScrolldown = () => {
        if (window.scrollY > 100) {
          setIsScrolled(true);
        } else {
          setIsScrolled(false);
        }
      };

    window.addEventListener("scroll", handleScroll);
    window.addEventListener("scroll", handleScrolldown);

    return () => window.removeEventListener("scroll", handleScroll, handleScrolldown);
  }, []);

  return (
    <div className="z-40 fixed bottom-0 left-0 right-0 h-20 lg:top-0 lg:h-full lg:w-24 text-white flex flex-row lg:flex-col lg:justify-between justify-center items-center lg:items-start lg:pl-8 lg:pt-36 ">
      {location.pathname !== "/" && (
        <button onClick={handleBack}>
          <svg
            width="50"
            height="49"
            viewBox="0 0 50 49"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M28.7412 45.4693L26.2638 47.9467C25.2148 48.9956 23.5186 48.9956 22.4808 47.9467L0.786743 26.2638C-0.262248 25.2148 -0.262248 23.5186 0.786743 22.4808L22.4808 0.786743C23.5297 -0.262248 25.226 -0.262248 26.2638 0.786743L28.7412 3.26414C29.8014 4.32429 29.779 6.05401 28.6966 7.09184L15.2494 19.9029H47.3217C48.8059 19.9029 50 21.097 50 22.5812V26.1522C50 27.6364 48.8059 28.8305 47.3217 28.8305H15.2494L28.6966 41.6416C29.7902 42.6794 29.8125 44.4091 28.7412 45.4693Z"
              fill="white"
            />
          </svg>
        </button>
      )}
      {location.pathname === "/" && (
        <div className="flex flex-col gap-8 lg:pt-36 -rotate-90 lg:rotate-0">
          <a href="#hero">
            <img src={activeBarIndex === 0 ? BarActive : BarUnactive} alt="" />
          </a>
          <a href="#projects">
            <img src={activeBarIndex === 1 ? BarActive : BarUnactive} alt="" />
          </a>
          <a href="#about">
            <img src={activeBarIndex === 2 ? BarActive : BarUnactive} alt="" />
          </a>
          <a href="#contact">
            <img src={activeBarIndex === 3 ? BarActive : BarUnactive} alt="" />
          </a>
        </div>
      )}

      <svg
        width="28"
        height="230"
        viewBox="0 0 38 312"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className={`hidden lg:block fixed left-10 transform duration-1000 ${ isScrolled ? "bottom-[-80px] opacity-0" : "bottom-0 opacity-100"}`}
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M16 312H19.88L19.88 210.75H16L16 312Z"
          fill="white"
        />
        <path d="M19.88 312L19.88 210.75H16L16 312H19.88Z" fill="white" />
        <path d="M19.88 312L19.88 210.75H16L16 312H19.88Z" fill="white" />
        <path
          d="M9.825 7.79336C9.825 6.62669 10.025 5.57669 10.425 4.64336C10.8417 3.71003 11.425 2.97669 12.175 2.44336C12.925 1.91003 13.8 1.64336 14.8 1.64336L14.8 4.69336C14.05 4.76003 13.4333 5.05169 12.95 5.56836C12.4667 6.10169 12.225 6.84336 12.225 7.79336C12.225 8.77669 12.4583 9.54336 12.925 10.0934C13.4083 10.6434 14.025 10.9184 14.775 10.9184C15.3583 10.9184 15.8333 10.7434 16.2 10.3934C16.5667 10.06 16.85 9.63503 17.05 9.11836C17.25 8.61836 17.4667 7.91836 17.7 7.01836C18 5.88503 18.3 4.96003 18.6 4.24336C18.9167 3.54336 19.4 2.94336 20.05 2.44336C20.7 1.94336 21.5667 1.69336 22.65 1.69336C23.65 1.69336 24.525 1.94336 25.275 2.44336C26.025 2.94336 26.6 3.64336 27 4.54336C27.4 5.44336 27.6 6.48503 27.6 7.66836C27.6 9.35169 27.175 10.7267 26.325 11.7934C25.4917 12.8767 24.3417 13.4767 22.875 13.5934V10.4434C23.5083 10.3934 24.05 10.0934 24.5 9.54336C24.95 8.99336 25.175 8.26836 25.175 7.36836C25.175 6.55169 24.9667 5.88503 24.55 5.36836C24.1333 4.85169 23.5333 4.59336 22.75 4.59336C22.2167 4.59336 21.775 4.75169 21.425 5.06836C21.0917 5.40169 20.825 5.81836 20.625 6.31836C20.425 6.81836 20.2083 7.50169 19.975 8.36836C19.6583 9.51836 19.3417 10.4517 19.025 11.1684C18.7083 11.9017 18.2167 12.5184 17.55 13.0184C16.9 13.535 16.025 13.7934 14.925 13.7934C14.0417 13.7934 13.2083 13.5517 12.425 13.0684C11.6417 12.6017 11.0083 11.91 10.525 10.9934C10.0583 10.0934 9.825 9.02669 9.825 7.79336ZM18.725 17.4563C20.425 17.4563 21.95 17.8479 23.3 18.6313C24.65 19.4313 25.7 20.5063 26.45 21.8563C27.2167 23.2229 27.6 24.7146 27.6 26.3313C27.6 28.1813 27.1417 29.8229 26.225 31.2563C25.325 32.7063 24.0417 33.7563 22.375 34.4063V30.9813C23.2917 30.5313 23.975 29.9063 24.425 29.1063C24.875 28.3063 25.1 27.3813 25.1 26.3313C25.1 25.1813 24.8417 24.1563 24.325 23.2563C23.8083 22.3563 23.0667 21.6479 22.1 21.1313C21.1333 20.6313 20.0083 20.3813 18.725 20.3813C17.4417 20.3813 16.3167 20.6313 15.35 21.1313C14.3833 21.6479 13.6333 22.3563 13.1 23.2563C12.5833 24.1563 12.325 25.1813 12.325 26.3313C12.325 27.3813 12.55 28.3063 13 29.1063C13.45 29.9063 14.1333 30.5313 15.05 30.9813V34.4063C13.3833 33.7563 12.1 32.7063 11.2 31.2563C10.3 29.8229 9.85 28.1813 9.85 26.3313C9.85 24.6979 10.225 23.2063 10.975 21.8563C11.7417 20.5063 12.8 19.4313 14.15 18.6313C15.5 17.8479 17.025 17.4563 18.725 17.4563ZM10 48.0172L16.95 44.0172V41.8422L10 41.8422V38.9922L27.375 38.9922L27.375 44.9922C27.375 46.3255 27.1417 47.4505 26.675 48.3672C26.2083 49.3005 25.5833 49.9922 24.8 50.4422C24.0167 50.9089 23.1417 51.1422 22.175 51.1422C21.0417 51.1422 20.0083 50.8089 19.075 50.1422C18.1583 49.4922 17.5333 48.4839 17.2 47.1172L10 51.4172V48.0172ZM19.225 41.8422V44.9922C19.225 46.0589 19.4917 46.8589 20.025 47.3922C20.5583 47.9422 21.275 48.2172 22.175 48.2172C23.075 48.2172 23.775 47.9505 24.275 47.4172C24.7917 46.8839 25.05 46.0755 25.05 44.9922L25.05 41.8422H19.225ZM9.825 63.9631C9.825 62.3464 10.2 60.8548 10.95 59.4881C11.7167 58.1381 12.775 57.0631 14.125 56.2631C15.4917 55.4798 17.025 55.0881 18.725 55.0881C20.425 55.0881 21.95 55.4798 23.3 56.2631C24.65 57.0631 25.7 58.1381 26.45 59.4881C27.2167 60.8548 27.6 62.3464 27.6 63.9631C27.6 65.5964 27.2167 67.0881 26.45 68.4381C25.7 69.8048 24.65 70.8798 23.3 71.6631C21.95 72.4464 20.425 72.8381 18.725 72.8381C17.025 72.8381 15.4917 72.4464 14.125 71.6631C12.775 70.8798 11.7167 69.8048 10.95 68.4381C10.2 67.0881 9.825 65.5964 9.825 63.9631ZM12.3 63.9631C12.3 65.1131 12.5583 66.1381 13.075 67.0381C13.6083 67.9381 14.3583 68.6381 15.325 69.1381C16.3083 69.6548 17.4417 69.9131 18.725 69.9131C20.0083 69.9131 21.1333 69.6548 22.1 69.1381C23.0667 68.6381 23.8083 67.9381 24.325 67.0381C24.8417 66.1381 25.1 65.1131 25.1 63.9631C25.1 62.8131 24.8417 61.7881 24.325 60.8881C23.8083 59.9881 23.0667 59.2798 22.1 58.7631C21.1333 58.2631 20.0083 58.0131 18.725 58.0131C17.4417 58.0131 16.3083 58.2631 15.325 58.7631C14.3583 59.2798 13.6083 59.9881 13.075 60.8881C12.5583 61.7881 12.3 62.8131 12.3 63.9631ZM12.3 79.7426V85.6176H10L10 76.8926L27.375 76.8926V79.7426L12.3 79.7426ZM12.3 92.101L12.3 97.976H10L10 89.251L27.375 89.251V92.101L12.3 92.101ZM27.375 107.284C27.375 109.134 27.0167 110.751 26.3 112.134C25.6 113.534 24.5833 114.609 23.25 115.359C21.9333 116.126 20.3917 116.509 18.625 116.509C16.8583 116.509 15.325 116.126 14.025 115.359C12.725 114.609 11.725 113.534 11.025 112.134C10.3417 110.751 10 109.134 10 107.284L10 101.609L27.375 101.609L27.375 107.284ZM12.325 107.284C12.325 109.318 12.875 110.876 13.975 111.959C15.075 113.043 16.625 113.584 18.625 113.584C20.6417 113.584 22.2167 113.043 23.35 111.959C24.4833 110.876 25.05 109.318 25.05 107.284L25.05 104.459L12.325 104.459V107.284ZM9.825 128.509C9.825 126.892 10.2 125.401 10.95 124.034C11.7167 122.684 12.775 121.609 14.125 120.809C15.4917 120.026 17.025 119.634 18.725 119.634C20.425 119.634 21.95 120.026 23.3 120.809C24.65 121.609 25.7 122.684 26.45 124.034C27.2167 125.401 27.6 126.892 27.6 128.509C27.6 130.142 27.2167 131.634 26.45 132.984C25.7 134.351 24.65 135.426 23.3 136.209C21.95 136.992 20.425 137.384 18.725 137.384C17.025 137.384 15.4917 136.992 14.125 136.209C12.775 135.426 11.7167 134.351 10.95 132.984C10.2 131.634 9.825 130.142 9.825 128.509ZM12.3 128.509C12.3 129.659 12.5583 130.684 13.075 131.584C13.6083 132.484 14.3583 133.184 15.325 133.684C16.3083 134.201 17.4417 134.459 18.725 134.459C20.0083 134.459 21.1333 134.201 22.1 133.684C23.0667 133.184 23.8083 132.484 24.325 131.584C24.8417 130.684 25.1 129.659 25.1 128.509C25.1 127.359 24.8417 126.334 24.325 125.434C23.8083 124.534 23.0667 123.826 22.1 123.309C21.1333 122.809 20.0083 122.559 18.725 122.559C17.4417 122.559 16.3083 122.809 15.325 123.309C14.3583 123.826 13.6083 124.534 13.075 125.434C12.5583 126.334 12.3 127.359 12.3 128.509ZM27.375 164.063L10 158.913V155.688L23.15 152.038L10 148.163L9.975 144.963L27.375 140.038L27.375 143.063L13.225 146.663L27.375 150.563V153.763L13.3 157.388L27.375 161.013V164.063ZM10 181.939V179.089L22.975 170.514H10L10 167.664H27.4V170.514L14.45 179.089H27.4V181.939H10Z"
          fill="white"
        />
      </svg>
    </div>
  );
};

export default LeftBar;
